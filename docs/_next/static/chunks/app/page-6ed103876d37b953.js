(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{429:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var o=n(5155),a=n(2115),l=n(3422),i=n.n(l);function r(e,t,n,o){let a=e+t/60+n/3600;return("S"===o||"W"===o)&&(a*=-1),a}let s=e=>new Promise((t,n)=>{try{if(console.log("开始提取EXIF数据，文件类型:",e.type),!e.type.startsWith("image/")){console.warn("文件不是图片类型:",e.type),t(null);return}i().getData(e,function(){console.log("EXIF.getData完成");try{let e=i().getAllTags(this);console.log("提取到的所有EXIF标签:",Object.keys(e).length?"有数据":"无数据"),e.GPSLatitude?console.log("检测到GPS数据"):console.log("未检测到GPS数据"),t(e)}catch(e){console.error("提取EXIF标签时出错:",e),t(null)}})}catch(e){console.error("调用EXIF.getData时出错:",e),n(e)}}),c=async e=>{try{console.log("开始从图片提取位置信息...");let t=await s(e);if(!t||!t.GPSLatitude||!t.GPSLongitude)return console.log("图片中没有GPS数据"),null;let n=function(e){if(!e||!e.GPSLatitude||!e.GPSLongitude)return console.log("GPS数据不存在或不完整"),null;try{let t,n,o,a,l,i,s,c;console.log("原始GPS数据:",{lat:e.GPSLatitude,latRef:e.GPSLatitudeRef,lon:e.GPSLongitude,lonRef:e.GPSLongitudeRef}),void 0!==e.GPSLatitude[0].numerator?(t=e.GPSLatitude[0].numerator/e.GPSLatitude[0].denominator,n=e.GPSLatitude[1].numerator/e.GPSLatitude[1].denominator,o=e.GPSLatitude[2].numerator/e.GPSLatitude[2].denominator):(t=e.GPSLatitude[0],n=e.GPSLatitude[1],o=e.GPSLatitude[2]),void 0!==e.GPSLongitude[0].numerator?(l=e.GPSLongitude[0].numerator/e.GPSLongitude[0].denominator,i=e.GPSLongitude[1].numerator/e.GPSLongitude[1].denominator,s=e.GPSLongitude[2].numerator/e.GPSLongitude[2].denominator):(l=e.GPSLongitude[0],i=e.GPSLongitude[1],s=e.GPSLongitude[2]),a=e.GPSLatitudeRef||"N",c=e.GPSLongitudeRef||"E";let d=r(t,n,o,a),u=r(l,i,s,c);return console.log("转换后的坐标:",{latitude:d,longitude:u}),{latitude:d,longitude:u}}catch(e){return console.error("解析GPS坐标时出错:",e),null}}(t);if(!n)return console.log("无法解析GPS坐标"),null;let o="".concat(n.latitude.toFixed(6),", ").concat(n.longitude.toFixed(6));console.log("提取到的位置信息:",o);let a=["广州 \xb7 太古汇","上海 \xb7 外滩","北京 \xb7 三里屯","深圳 \xb7 华侨城","杭州 \xb7 西湖"],l=Math.abs(n.latitude*n.longitude)%a.length,i=a[Math.floor(l)];return console.log("模拟位置名称:",i),i}catch(e){return console.error("从图片提取位置信息失败:",e),null}};function d(){let[e,t]=(0,a.useState)([]),[n,l]=(0,a.useState)("xiaohongshu"),[i,r]=(0,a.useState)("casual"),[s,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)(null),[m,g]=(0,a.useState)(!0),[x,p]=(0,a.useState)(""),j=(0,a.useRef)(null),v=async n=>{let o=n.target.files;if(!o||0===o.length)return;console.log("正在处理 ".concat(o.length," 张图片..."));let a=Array.from(o).map(async(t,n)=>{let o=null;try{console.log("正在从图片 ".concat(n+1," 提取EXIF数据...")),(o=await c(t))?(console.log("成功从图片 ".concat(n+1," 中提取到位置信息:"),o),0===n&&0===e.length&&(console.log("自动设置位置信息:",o),p(o),g(!0))):console.log("图片 ".concat(n+1," 中没有位置信息"))}catch(e){console.error("提取图片 ".concat(n+1," 位置信息失败:"),e)}return{id:"img-".concat(Date.now(),"-").concat(n),file:t,url:URL.createObjectURL(t),order:e.length+n,location:o}});try{let n=await Promise.all(a);console.log("所有图片处理完成，图片数据:",n);let o=n.some(e=>e.location);console.log("是否从图片中提取到位置信息:",o),t([...e,...n]),h(null)}catch(e){console.error("处理图片时出错:",e),alert("处理图片时出错，请重试")}n.target&&(n.target.value="")},f=n=>{let o=e.filter(e=>e.id!==n);o.forEach((e,t)=>{e.order=t}),t(o),h(null)},S=(n,o)=>{let a=e.findIndex(e=>e.id===n);if(-1===a)return;let l=[...e];"up"===o&&a>0?([l[a].order,l[a-1].order]=[l[a-1].order,l[a].order],[l[a],l[a-1]]=[l[a-1],l[a]]):"down"===o&&a<l.length-1&&([l[a].order,l[a+1].order]=[l[a+1].order,l[a].order],[l[a],l[a+1]]=[l[a+1],l[a]]),t(l),h(null)},N=async()=>{if(0===e.length)return void alert("请至少选择一张图片");d(!0);try{let t=null;if(m){if(x)t=x;else for(let n of e)if(n.location){t=n.location,console.log("使用图片中的位置信息:",t);break}}console.log("最终使用的位置信息:",t);let o=await Promise.all(e.map(async(t,n)=>{if(console.log("处理图片 ".concat(n+1,"/").concat(e.length)),t.url.startsWith("data:image"))return t.url;try{let e=await fetch(t.url);if(!e.ok)throw Error("获取图片失败: ".concat(e.status));let n=await e.blob();return await P(n)}catch(e){throw console.error("转换图片 ".concat(n+1," 格式失败:"),e),Error("图片 ".concat(n+1," 处理失败，请重新选择图片"))}}));console.log("成功处理 ".concat(o.length," 张图片")),console.log("正在调用API生成文案...");let a=await fetch("/api/generate-caption",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({images:o,platform:n,style:i,location:t,useLocation:!!t})});if(!a.ok){let e=await a.json();throw Error(e.error||"生成文案失败")}let l=await a.json();console.log("文案生成成功"),h(l.caption)}catch(e){console.error("生成文案时出错:",e),alert("生成文案失败，请重试: "+(e instanceof Error?e.message:"未知错误"))}finally{d(!1)}},P=e=>new Promise((t,n)=>{let o=new FileReader;o.onloadend=()=>t(o.result),o.onerror=n,o.readAsDataURL(e)});return(0,a.useEffect)(()=>()=>{e.forEach(e=>{URL.revokeObjectURL(e.url)})},[e]),(0,o.jsxs)("div",{className:"social-caption-generator",children:[(0,o.jsxs)("header",{children:[(0,o.jsx)("h1",{children:"AI社交文案生成器"}),(0,o.jsx)("p",{children:"上传照片，一键生成社交平台文案"})]}),(0,o.jsxs)("main",{children:[(0,o.jsxs)("section",{className:"image-section",children:[(0,o.jsx)("h2",{children:"选择并排序照片"}),(0,o.jsx)("p",{className:"tip",children:"照片顺序将影响文案生成结果"}),(0,o.jsxs)("div",{className:"image-grid",children:[e.map(t=>(0,o.jsxs)("div",{className:"image-item",children:[(0,o.jsx)("div",{className:"image-order",children:t.order+1}),(0,o.jsx)("img",{src:t.url,alt:"照片 ".concat(t.order+1)}),(0,o.jsxs)("div",{className:"image-controls",children:[(0,o.jsx)("button",{onClick:()=>S(t.id,"up"),disabled:0===t.order,className:"control-btn",children:"↑"}),(0,o.jsx)("button",{onClick:()=>f(t.id),className:"control-btn remove",children:"\xd7"}),(0,o.jsx)("button",{onClick:()=>S(t.id,"down"),disabled:t.order===e.length-1,className:"control-btn",children:"↓"})]})]},t.id)),(0,o.jsxs)("div",{className:"add-image-container",onClick:()=>{j.current&&j.current.click()},children:[(0,o.jsx)("div",{className:"add-image-btn",children:"+"}),(0,o.jsx)("p",{children:"添加照片"})]})]}),(0,o.jsx)("input",{type:"file",accept:"image/*",multiple:!0,ref:j,onChange:v,style:{display:"none"}})]}),(0,o.jsxs)("section",{className:"options-section",children:[(0,o.jsxs)("div",{className:"platform-selector",children:[(0,o.jsx)("h3",{children:"选择平台"}),(0,o.jsx)("div",{className:"button-group",children:[{id:"xiaohongshu",name:"小红书"},{id:"weibo",name:"微博"},{id:"wechat",name:"朋友圈"},{id:"douyin",name:"抖音"}].map(e=>(0,o.jsx)("button",{className:"platform-btn ".concat(n===e.id?"active":""),onClick:()=>l(e.id),children:e.name},e.id))})]}),(0,o.jsxs)("div",{className:"style-selector",children:[(0,o.jsx)("h3",{children:"选择风格"}),(0,o.jsx)("div",{className:"button-group",children:[{id:"casual",name:"日常"},{id:"healing",name:"治愈"},{id:"humorous",name:"幽默"},{id:"contrast",name:"反差"},{id:"elegant",name:"优雅"}].map(e=>(0,o.jsx)("button",{className:"style-btn ".concat(i===e.id?"active":""),onClick:()=>r(e.id),children:e.name},e.id))})]}),(0,o.jsxs)("div",{className:"location-option",children:[(0,o.jsx)("h3",{children:"位置信息"}),(0,o.jsxs)("div",{className:"location-input-group",children:[(0,o.jsxs)("label",{className:"switch",children:[(0,o.jsx)("input",{type:"checkbox",checked:m,onChange:()=>g(!m)}),(0,o.jsx)("span",{className:"slider round"})]}),(0,o.jsx)("span",{children:"添加位置信息"})]}),m&&(0,o.jsxs)("div",{className:"location-input-container",children:[(0,o.jsx)("input",{type:"text",placeholder:"输入位置，如：广州 \xb7 太古汇",value:x,onChange:e=>p(e.target.value),className:"location-input"}),(0,o.jsx)("p",{className:"location-tip",children:e.some(e=>e.location)?"已从照片中提取位置信息，您也可以手动修改":"未能从照片中提取位置信息，请手动输入"})]})]}),(0,o.jsx)("button",{className:"generate-btn",onClick:N,disabled:s||0===e.length,children:s?"生成中...":"生成文案"})]}),u&&(0,o.jsxs)("section",{className:"result-section",children:[(0,o.jsx)("h2",{children:"生成的文案"}),(0,o.jsxs)("div",{className:"caption-container",children:[(0,o.jsx)("pre",{className:"caption-text",children:u}),(0,o.jsx)("button",{className:"copy-btn",onClick:()=>{u&&navigator.clipboard.writeText(u).then(()=>{alert("文案已复制到剪贴板")}).catch(e=>{console.error("复制失败:",e),alert("复制失败，请手动复制")})},children:"复制文案"})]}),(0,o.jsxs)("div",{className:"preview-title",children:[(0,o.jsx)("h3",{children:"预览效果"}),(0,o.jsxs)("p",{children:["平台: ","xiaohongshu"===n?"小红书":"weibo"===n?"微博":"wechat"===n?"朋友圈":"抖音"]})]}),(0,o.jsxs)("div",{className:"preview-container ".concat(n),children:[(0,o.jsxs)("div",{className:"preview-header",children:[(0,o.jsx)("div",{className:"preview-avatar"}),(0,o.jsxs)("div",{className:"preview-user",children:[(0,o.jsx)("div",{className:"preview-username",children:"用户名"}),"xiaohongshu"===n&&x&&(0,o.jsxs)("div",{className:"preview-location",children:[" ",x]})]})]}),(0,o.jsxs)("div",{className:"preview-images",children:[e.slice(0,4).map(e=>(0,o.jsx)("div",{className:"preview-image",children:(0,o.jsx)("img",{src:e.url,alt:"预览 ".concat(e.order+1)})},e.id)),e.length>4&&(0,o.jsxs)("div",{className:"preview-more",children:["+",e.length-4]})]}),(0,o.jsx)("div",{className:"preview-caption",children:u.split("\n").map((e,t)=>(0,o.jsx)("p",{children:e||" "},t))})]})]})]}),(0,o.jsx)("footer",{children:(0,o.jsx)("p",{children:" 2025 AI - "})})]})}},1580:(e,t,n)=>{Promise.resolve().then(n.bind(n,429))}},e=>{var t=t=>e(e.s=t);e.O(0,[422,441,684,358],()=>t(1580)),_N_E=e.O()}]);